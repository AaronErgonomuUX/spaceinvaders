<!DOCTYPE html>
<html>
	<head>
		<title>Space Invaders</title>
		<style>
			body { 
				margin: 0px;
				padding: 0px;
			}
			#starfield {
				width:100%;
				height:100%;
				z-index: -1;
				position: absolute;
				left: 0px;
				top: 0px;
			}
			#gamecontainer {
				width: 800px;
				margin-left: auto;
				margin-right: auto;
			}
			#gamecanvas { 
				width: 800px;
				height: 600px;
			}
		</style>
	</head>
<body>
	<div id="starfield"></div>
	<div id="gamecontainer">
	<canvas id="gameCanvas"></canvas>
	<p id="gameOver"></p>
	</div>
	<script src="starfield.js"></script>
	<script src="spaceinvaders.js"></script>
	<script>

		//	Create the starfield.
		var container = document.getElementById('starfield');
		var starfield = new Starfield();
		starfield.initialise(container);
		starfield.start();

		//	Setup the canvas.
		var canvas = document.getElementById("gameCanvas");
		canvas.width = 800;
		canvas.height = 600;

		//	Create the game.
		var game = new Game();

		//	Initialise it with the game canvas.
		game.initialise(canvas);

		//	Start the game.
		game.onGameLost = function onGameLost(game) {
			document.getElementById("gameOver").innerText = "You Lost!";
		};

		game.onGameWon = function onGameWon(game) {
			document.getElementById("gameOver").innerText = "You Won!";
		};
		game.start();

		//	Listen for keyboard events.
		var pressedKeys = [];
		window.addEventListener("keydown", function keydown(e) {
			var keycode = window.event.keycode || e.which;
		    if(!pressedKeys[keycode])
		    	pressedKeys[keycode] = true;
		    //	Supress further processing of left/right/space (37/29/32)
		    if(keycode == 37 || keycode == 39 || keycode == 32) {
		    	e.preventDefault();
		    }
		});
		window.addEventListener("keyup", function keydown(e) {
			var keycode = window.event.keycode || e.which;
		    if(pressedKeys[keycode])
		    	delete pressedKeys[keycode];
		});
		setInterval(function() { 
			//	If left/right/space keys are pressed, handle them.
			if(pressedKeys[37]) {
				game.moveShip(-1);
			}
			if(pressedKeys[39]) {
				game.moveShip(1);
			}
			if(pressedKeys[32]) {
				game.shipFire();
			}
		}, 10);
	</script>
</body>
</html>